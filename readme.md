# PRD : Duel Tower — 노드 탐색형 턴제 카드게임 웹앱

* 문서 버전: v0.2
* 작성일: 2026-02-23

## 1) 요약

Duel Tower는 플레이어가 **사전에 정해진 카드 풀**로 덱(12장)과 EX 카드(1장)를 구성해, 지인들과 함께 **노드를 선택하며 탑을 진행**하는 **협동 턴제 카드 전투 시뮬레이터**다.
핵심 가치는 “수동 진행에서 발생하는 실수/번거로움”을 제거하기 위해 **덱 조작(특히 서치) + 턴 처리 + 카드 효과/상태 자동화**를 서버 권위(서버가 판정 확정)로 제공하는 것이다.

---

## 2) 배경 / 문제 정의

### 배경

기존 TRPG용 플랫폼(코코포리아)은 카드/덱 게임 운영에 필요한 자동화가 부족해, 룰이 복잡해질수록 운영 비용과 오류가 폭증한다.

### 문제

* **덱 서치 부재**: 서치 효과 사용 시 덱 전체를 뽑아 눈으로 찾고 다시 넣어야 함.
* **수동 진행 오류**: 카드게임 특성상 “조건/상한/하한/예외”가 많아 사람이 틀리기 쉬움.
* **덱 복사 부재**: 동일한 몹/구성을 여러 개 준비할 때 반복 작업이 과함.
* **자동화 없이는 굴리기 힘든 매커니즘**: 트리거/상태/상한·하한(min/max) 등.
* **수학 함수/연산 부족**: 상한/하한, 절반 감소(올림/내림) 등 구현이 어려움.

---

## 3) 목표 / 비목표

### Goals (MVP)

1. 사용자는 자신의 턴에 규칙에 맞게 카드/EX를 사용할 수 있다.
2. **턴 종료**로 다음 턴이 정확히 시작된다(플레이어/GM/NPC 포함).
3. 카드의 효과 처리는 자동화된다(피해/회복/상태/서치/셔플/토큰 등).
4. 노드 진행(선택지 1개 선택, 되돌리기 불가)이 웹에서 관리된다.
5. “덱 서치/셔플/존 이동/로그”가 **사람이 실수하기 어려운 형태**로 제공된다.

### Non-goals (MVP 범위 제외)

1. PVP(플레이어 간 대전)
2. 적 AI(적의 행동을 자동으로 최적화/판단)
3. 커스텀 카드의 추가/수정/삭제(카드 풀은 고정)

---

## 4) 타겟 사용자 / 핵심 시나리오 (Top 3)

### 타겟 사용자

* 플레이어(지인): 룰을 즐기는 참가자
* GM(본인): 노드/전투/적 운영자(수동 운영의 고통을 줄이는 것이 핵심 니즈)

### 핵심 시나리오

1. **세션 생성 → 참가 → 덱 선택**

* GM이 “탑 세션”을 생성하고 참가 코드를 발급한다.
* 플레이어가 참가 후, 저장된 캐릭터/덱 프리셋을 선택해 준비 완료한다.

2. **전투 진행(턴/드로우/카드 사용/자동 처리)**

* 전투 시작 시 이니셔티브가 결정되고 턴 순서가 표시된다.
* 내 턴에 손패에서 카드를 선택 → 대상 선택(필요 시) → 서버가 사용 가능 여부 검증 후 효과를 자동 적용한다.
* 덱 서치가 필요한 카드면 “조건에 맞는 카드만” 표시되는 서치 UI로 선택 후 자동 셔플한다.
* 행동/결과는 모두 로그로 남는다.

3. **노드 클리어 → 다음 노드 선택**

* 전투/이벤트가 종료되면 노드가 완료 처리된다.
* 다음 노드 선택지가 표시되고, 파티가 1개를 선택해 진행한다(되돌리기 불가).

---

## 5) 규칙 기반 요구사항(시뮬레이터가 반드시 지켜야 하는 룰)

MVP에서 **룰 위반 입력을 서버가 차단**해야 한다.

### 카드/덱 기본

* 스킬 덱 12장 + EX 카드 1장(별도 존)
* 전투 시작 손패 4장
* 턴 시작 드로우: 손패 4장 미만이면 2장, 아니면 1장
* 손패 최대 6장(초과 시 즉시 버리기 선택 UI)
* 덱이 비면 묘지를 덱으로 되돌려 새 덱 구성
* “뽑아야 할 장수 > 남은 덱”이면 남은 덱을 뽑고 리필 후 부족분 추가 드로우
* 패 교환: 내 턴 1회, 손패 1장 버리고 1장 드로우(토큰이면 드로우 없음)

### 존(Zone)

* 덱 / 손패 / 묘지 / 필드 / 제외 / EX
* 필드: 설치/소환 카드가 남는 장소, 개인별 필드 공유 없음, 필드 최대 5장
* 토큰: 패/필드에서는 일반 카드처럼 취급, 그 외 존으로 이동하면 소멸, 패 교환으로 버리면 추가 드로우 없음
* EX 카드: 사용 시 다음 라운드 종료까지 비활성(쿨다운), 스킬 카드 대상 효과로 EX를 대상으로 할 수 없음

### 피해/회복 처리 파이프라인

* 대상 확정 → 증감 계산 → 치명 체크(치명 n = n×10%) → 진영 효과 → 최종 산출 → 방어(회피 등)
* 진영 효과(예: 방벽)는 진영 단위로 적용

### 키워드(고정 풀, MVP 지원)

강화/약화/설치/소환/제외/부동/명경/필중/관통/집념/치명 n/증강 n/충전 n

* 부동: 손패에서 버릴 수 없음(강제 버리기 상황 예외 포함)
* 집념: 코스트 부족해도 사용 가능, 부족 코스트만큼 턴 종료 회복 행동력 차감, 1턴 1장 제한
* 필중: 회피 무시 / 관통: 보호·방벽 무시 / 명경: 도발 무시

### 상태(고정 풀, MVP 지원)

* 이로운: 도발, 회피, 보호, 방벽(진영), 재생, 활력
* 해로운: 기절, 중압, 혼란, 고통, 파괴, 쇠약, 취약
  각 상태의 “발동 시점/감소/제거 규칙”을 서버가 처리한다(예: 재생/고통은 턴 종료 시 처리 후 절반 감소 등).

---

## 6) 기능 요구사항(Functional Requirements)

### P0 — 코어 플레이

**FR-1 세션/참가**

* GM은 세션 생성, 참가 코드 발급, 세션 시작/종료를 할 수 있다.
* AC: 참가 코드는 추측이 어려운 형태이며, 참가자 목록/상태(준비/미준비)가 표시된다.

**FR-2 캐릭터/덱 프리셋**

* 사용자는 캐릭터 프로필 + 덱(12장) + EX(1장)을 프리셋으로 저장/선택할 수 있다.
* AC: 카드 풀은 고정이며, 덱 규칙(장수/중복 제한 등)은 저장 시 검증된다.

**FR-3 덱 복사(운영 편의)**

* GM은 프리셋을 복사해 “동일 몹/구성”을 빠르게 여러 개 만들 수 있다.
* AC: 클릭 몇 번으로 복제본 생성, 이름만 바꿔 저장 가능.

**FR-4 전투 시작/턴 순서**

* 전투 시작 시 이니셔티브를 기록하고 턴 순서를 고정/표시한다(동률 처리 규칙 포함).
* AC: 현재 턴 표시, 다음 턴 미리보기, 라운드 카운트 표시.

**FR-5 카드 사용(검증 + 자동 효과)**

* 사용자는 손패/필드/EX에서 사용 가능한 행동을 선택할 수 있다.
* 서버는 코스트/제약/대상/키워드를 검증하고, 통과 시 효과를 적용한다.
* AC: 잘못된 대상/코스트 부족/집념 제한 등은 서버가 거부하고 이유를 반환한다.

**FR-6 덱 서치 UI**

* 카드 효과로 덱 서치가 발생하면 “조건에 맞는 카드만” 리스트에 표시하고, 선택 후 지정 존으로 이동 + 필요 시 셔플 처리한다.
* AC: 덱 전체를 펼쳐보지 않아도 서치가 완료되며, 결과가 로그에 남는다.

**FR-7 존 자동 이동/강제 처리**

* 사용 카드의 묘지 이동, 설치/소환의 필드 잔류, 제외, 토큰 소멸, 손패 초과 시 강제 버리기 등 규칙을 자동 적용한다.
* AC: 손패가 6장을 넘는 순간 버리기 UI가 뜨고, 해결 전까지 진행이 막힌다.

**FR-8 상태/진영 효과 처리**

* 상태 부여/중첩/감소/제거 및 진영 효과를 서버가 처리한다.
* AC: 턴 종료/라운드 진행 같은 “일괄 처리 타이밍”에 상태가 자동 갱신된다.

**FR-9 전투 로그**

* 모든 주요 이벤트(카드 사용, 서치, 피해 계산 결과, 상태 변화, 턴 전환)를 로그로 남기고 참가자가 열람 가능하다.
* AC: “누가/무엇을/대상/결과”가 한 줄로 요약되며, 상세 계산(선택)도 확인 가능하다.

### P0 — 노드 진행

**FR-10 노드/선택지**

* 세션은 노드 단위로 진행되며, 노드마다 선택지 중 1개만 선택 가능하고 되돌릴 수 없다.
* AC: 현재 위치/이력 표시, 다음 선택지 UI 제공(아무것도 없음/시설/저주/전투/보스/??? 등).

---

## 7) 비기능 요구사항(NFR)

* 동기화: 실시간 상태 공유(WebSocket 권장), 서버 권위로 상태 확정
* 일관성: 중복 클릭/중복 요청 방지(동일 커맨드 재처리 금지)
* 가시성: “왜 거부됐는지” 오류 메시지가 사용자 액션 단위로 명확해야 함
* 성능: 4~6인 세션에서 턴/카드 사용 반영이 체감 지연 없이 동작
* 권한: GM만 가능한 액션(노드 선택 확정, NPC/적 조작 등) 분리

---

## 8) UX/화면(최소)

1. 로비: 세션 생성/참가, 참가자 목록, 준비 상태, 시작 버튼
2. 프리셋: 캐릭터/덱/EX 선택 및 저장, GM용 복사 기능
3. 노드 화면: 현재 노드, 선택지 1개 선택, 진행 이력
4. 전투 화면:

* 턴/라운드/이니셔티브
* 내 손패/필드/묘지/덱 매수, EX 쿨다운
* 대상 선택(적/아군/소환물)
* 상태/진영 효과 표시
* 로그 패널

5. 서치 모달: 조건 카드 목록, 선택 → 자동 처리

---

## 9) 데이터 모델(초안)

* Session: id, code, gmId, players[], phase(lobby/node/combat), log[]
* Run/Map: currentNodeId, visitedNodeIds[], availableChoices[]
* CombatState: round, turnOrder[], currentTurn, teams(ally/enemy), globalEffects[]
* PlayerState: deck[], hand[], grave[], field[], excluded[], exState, stats(HP/행동력 등), statuses[]
* CardDefinition: id, name, cost, keywords[], effectId
* CardInstance: instanceId, defId, ownerId, zone, counters(충전 등)
* Effect: trigger(사용/턴종료/피해시 등), actions[](피해/회복/상태/서치/셔플/min/max 등)

---

## 10) 성공 지표(초기)

* 덱 서치가 “덱 전체 펼침 없이” UI로 완료된다(선택 + 자동 셔플 포함).
* 카드 사용/상태 처리에서 “수동 계산/실수”가 사실상 발생하지 않는다.
* GM 입장에서 동일 몹/덱 준비 시간이 크게 줄어든다(복사 기능 체감).

---

## 11) 마일스톤(구현 우선순위)

1. **존/덱 조작**: 드로우/버리기/묘지/리필/셔플/서치/토큰/손패 상한/EX 쿨
2. **턴 엔진**: 이니셔티브/턴 전환/라운드/턴 시작 드로우/턴 종료 일괄 처리
3. **피해·회복 파이프라인**: 치명/진영/방어(회피·보호·방벽)/관통·필중
4. **상태/키워드 전량 지원**: 기절·중압·혼란·고통·파괴·쇠약·취약 + 이로운 상태들
5. **노드 진행 UI**: 선택지 1개 선택/되돌리기 불가/이력 표시
